:root{
  --bg: #0b0d10;
  --fg: #d7e0e7;
  --fg-dim: #8a96a1;
  --accent: #8fd3ff;

  --glitch-bg: #050607;
  --glitch-fg: #d7e0e7;
  --glitch-accent: #ff74d0;

  --mono: ui-monospace, "JetBrains Mono", "IBM Plex Mono", Menlo, Consolas, monospace;

  /* ASCII-Zellgröße (wird dynamisch via JS gesetzt) */
  --ascii-cell: 10px;

  /* Controls */
  --ctl-bg: rgba(8,10,12,0.55);
  --ctl-border: rgba(255,255,255,0.08);
  --ctl-hover: rgba(255,255,255,0.3);
  --btn-bg: rgba(255,255,255,0.03);
  --btn-border: rgba(255,255,255,0.12);
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0; background: var(--bg); color: var(--fg);
  font-family: var(--mono);
  -webkit-tap-highlight-color: transparent;
}

.only-mobile { display: none; }

#app { min-height: 100dvh; display: flex; flex-direction: column; }

.topbar {
  display: grid; grid-template-columns: auto 1fr auto auto;
  gap: 12px; align-items: center; padding: 10px 12px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  backdrop-filter: blur(6px);
}
#btn-menu {
  background: transparent; border: 1px solid var(--btn-border);
  color: var(--fg); padding: 6px 10px; border-radius: 8px; cursor: pointer;
}

.brand { letter-spacing: 2px; font-weight: 700; color: var(--accent); }
.brand .dim { color: var(--fg-dim); }

.nowplaying { opacity: .95; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.nowplaying .sep { opacity: .6; margin: 0 8px; }

.actions { display: flex; gap: 8px; }
.actions button {
  background: transparent; border: 1px solid var(--btn-border);
  color: var(--fg); padding: 6px 10px; border-radius: 8px; cursor: pointer;
}
.actions button:hover { border-color: var(--ctl-hover); }

.stage {
  position: relative; flex: 1;
  display: grid; grid-template-columns: 1fr min(340px, 36vw);
  gap: 14px; padding: 14px;
}

#ascii {
  display: block; margin: 0; width: 100%; height: 100%;
  font-family: var(--mono); font-size: var(--ascii-cell); line-height: 1; letter-spacing: 0;
  white-space: pre;
  background:
    radial-gradient(1200px 600px at 30% -10%, rgba(143,211,255,0.12), transparent 60%),
    radial-gradient(1200px 600px at 100% 100%, rgba(255,116,208,0.09), transparent 60%);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 12px; padding: 8px; overflow: hidden; touch-action: manipulation;
}

.controls {
  position: sticky; bottom: 0; align-self: end;
  background: var(--ctl-bg); border: 1px solid var(--ctl-border);
  border-radius: 12px; padding: 10px; display: grid; gap: 8px; backdrop-filter: blur(8px);
}
.controls .row { display: flex; align-items: center; gap: 8px; }
.controls .buttons { justify-content: center; gap: 12px; }
.controls button {
  background: var(--btn-bg); color: var(--fg); border: 1px solid var(--btn-border);
  padding: 10px 14px; border-radius: 12px; cursor: pointer; min-width: 44px; min-height: 44px;
}
.controls button.big { font-size: 18px; }
.controls button.primary { border-color: var(--accent); }
.controls button:hover { border-color: var(--ctl-hover); }
.controls input[type="range"] { width: 100%; }

.seekrow { gap: 12px; }
.time { font-variant: tabular-nums; opacity: .85; min-width: 120px; text-align: left; }
.vol { display: flex; align-items: center; gap: 8px; opacity: .9; }

#btn-shuffle[aria-pressed="true"],
#btn-loop[aria-pressed="true"] { border-color: var(--accent); }

.playlist {
  border: 1px solid rgba(255,255,255,0.06); border-radius: 12px;
  padding: 10px; overflow: auto; background: rgba(8,10,12,0.35); backdrop-filter: blur(6px);
  max-height: calc(100% - 56px);
}

.track {
  display: grid; grid-template-columns: auto 1fr auto;
  gap: 10px; align-items: center; padding: 10px; border-radius: 10px; cursor: pointer; min-height: 44px;
}
.track:hover { background: rgba(255,255,255,0.04); }
.track.active { outline: 1px solid var(--accent); background: rgba(143,211,255,0.08); }
.track .idx { opacity: .6; min-width: 28px; text-align: right; }
.track .meta { overflow: hidden; }
.track .title { white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
.track .artist { font-size: 12px; opacity: .6; }
.track .dur { font-variant: tabular-nums; opacity: .7; }

.version-badge {
  position: fixed; bottom: 10px; right: 10px;
  font-family: var(--mono); font-size: 12px; opacity: .5;
  background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.12);
  padding: 4px 8px; border-radius: 8px;
}

/* Glitch Theme */
body.glitch { background: var(--glitch-bg); color: var(--glitch-fg); }
body.glitch #ascii {
  background:
    repeating-linear-gradient(0deg, rgba(255,116,208,0.05), rgba(255,116,208,0.05) 2px, transparent 2px, transparent 4px),
    radial-gradient(900px 450px at 80% 0%, rgba(255,116,208,0.12), transparent 60%),
    radial-gradient(900px 450px at 10% 100%, rgba(143,211,255,0.10), transparent 60%);
  border-color: rgba(255,116,208,0.15);
}
body.glitch .brand { color: var(--glitch-accent); }

/* --- Mobile First --- */
@media (max-width: 880px) {
  .only-mobile { display: inline-flex; }
  .topbar { grid-template-columns: auto 1fr auto; }
  .actions { display: none; }

  .stage { grid-template-columns: 1fr; grid-template-rows: 1fr auto; gap: 10px; padding: 10px; }
  .controls { position: sticky; bottom: 8px; padding: 10px; }

  .playlist {
    position: fixed; inset: auto 0 0 0; max-height: 55vh;
    transform: translateY(100%); transition: transform .25s ease; z-index: 10;
    border-top-left-radius: 12px; border-top-right-radius: 12px;
    border-bottom-left-radius: 0; border-bottom-right-radius: 0;
    background: rgba(10,12,14,0.92);
  }
  body.playlist-open .playlist { transform: translateY(0%); }
  body.playlist-peek .playlist { transform: translateY(82%); } /* kurzer Peek */
  #ascii { border-radius: 12px; }
}
